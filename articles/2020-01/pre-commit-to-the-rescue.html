<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="pre-commit to the rescue" /><meta name="author" content="iwpnd" /><meta property="og:locale" content="en_US" /><meta name="description" content="During a keynote on last years PyCON Berlin somebody mentioned that he was watching that guy on twitch code for an audience. While hesitent at first, I actually followed @anthonywritescode / @asottile and checked him out the next weekend. While the amazement of watching other people, especially proficient people, code live and answer question in real time is a topic in itself,what I found especially interesting was what he was working on - something called pre-commit." /><meta property="og:description" content="During a keynote on last years PyCON Berlin somebody mentioned that he was watching that guy on twitch code for an audience. While hesitent at first, I actually followed @anthonywritescode / @asottile and checked him out the next weekend. While the amazement of watching other people, especially proficient people, code live and answer question in real time is a topic in itself,what I found especially interesting was what he was working on - something called pre-commit." /><link rel="canonical" href="https://iwpnd.pw//articles/2020-01/pre-commit-to-the-rescue" /><meta property="og:url" content="https://iwpnd.pw//articles/2020-01/pre-commit-to-the-rescue" /><meta property="og:site_name" content="iwpnd" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-01-10T11:37:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="pre-commit to the rescue" /><meta name="twitter:site" content="@imwithpanda" /><meta name="twitter:creator" content="@imwithpanda" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"iwpnd"},"dateModified":"2020-01-10T11:37:00+00:00","datePublished":"2020-01-10T11:37:00+00:00","description":"During a keynote on last years PyCON Berlin somebody mentioned that he was watching that guy on twitch code for an audience. While hesitent at first, I actually followed @anthonywritescode / @asottile and checked him out the next weekend. While the amazement of watching other people, especially proficient people, code live and answer question in real time is a topic in itself,what I found especially interesting was what he was working on - something called pre-commit.","headline":"pre-commit to the rescue","mainEntityOfPage":{"@type":"WebPage","@id":"https://iwpnd.pw//articles/2020-01/pre-commit-to-the-rescue"},"url":"https://iwpnd.pw//articles/2020-01/pre-commit-to-the-rescue"}</script><title> pre-commit to the rescue - iwpnd</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="iwpnd" href="/atom.xml"><link rel="alternate" type="application/json" title="iwpnd" href="https://iwpnd.pw//feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}.highlight{background:#282a36;color:#f8f8f2;font-size:.8rem}.highlight .hll,.highlight .s,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .dl,.highlight .sd,.highlight .s2,.highlight .se,.highlight .sh,.highlight .si,.highlight .sx,.highlight .sr,.highlight .s1,.highlight .ss{color:#f1fa8c}.highlight .go{color:#44475a}.highlight .err,.highlight .g,.highlight .l,.highlight .n,.highlight .x,.highlight .p,.highlight .ge,.highlight .gr,.highlight .gh,.highlight .gi,.highlight .gp,.highlight .gs,.highlight .gu,.highlight .gt,.highlight .ld,.highlight .no,.highlight .nd,.highlight .ni,.highlight .ne,.highlight .nn,.highlight .nx,.highlight .py,.highlight .w,.highlight .bp{color:#f8f8f2}.highlight .gh,.highlight .gi,.highlight .gu{font-weight:bold}.highlight .ge{text-decoration:underline}.highlight .bp{font-style:italic}.highlight .c,.highlight .ch,.highlight .cm,.highlight .cpf,.highlight .c1,.highlight .cs{color:#6272a4}.highlight .kd,.highlight .kt,.highlight .nb,.highlight .nl,.highlight .nv,.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#8be9fd}.highlight .kd,.highlight .nb,.highlight .nl,.highlight .nv,.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{font-style:italic}.highlight .na,.highlight .nc,.highlight .nf,.highlight .fm{color:#50fa7b}.highlight .k,.highlight .o,.highlight .cp,.highlight .kc,.highlight .kn,.highlight .kp,.highlight .kr,.highlight .nt,.highlight .ow{color:#ff79c6}.highlight .m,.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo,.highlight .il{color:#bd93f9}.highlight .gd{color:#f55}</style></head><body><main role="main"><header role="banner"> <img src="/img/iwpnd-logo.png" alt="iwpnd logo"><nav role="navigation"><ul><li><a href="/" >blog</a></li><li><a href="/til" >til</a></li><li><a href="/about" >about</a></li><li><a href="/search" >search</a></li><li><a href="/imprint" >imprint</a></li></ul></nav></header><script async src="https://www.googletagmanager.com/gtag/js?id=UA-156087226-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-156087226-1'); </script><section class="post"><h2>pre-commit to the rescue</h2><p>During a keynote on last years <a href="https://pycon.de">PyCON Berlin</a> somebody mentioned that he was watching that guy on <a href="https://www.twitch.tv/">twitch</a> code for an audience. While hesitent at first, I actually followed <a href="https://twitch.tv/anthonywritescode">@anthonywritescode</a> / <a href="https://github.com/asottile">@asottile</a> and checked him out the next weekend. While the amazement of watching other people, especially proficient people, code live and answer question in real time is a topic in itself,what I found especially interesting was what he was working on - something called <a href="https://pre-commit.com/">pre-commit</a>.</p><p>Raise your hand if you have accidentally committed code that does not compile, or an invalid json without that nasty closing bracket.</p><p>I’m sure you haven’t, but I most certainly did.</p><h3 id="git-hooks">git hooks</h3><p>The whole concept of git hooks is new to me. What they do is to perform actions before or after <code class="language-plaintext highlighter-rouge">git commit</code> or before a <code class="language-plaintext highlighter-rouge">git push</code>. So if I commit, a hook will check my commit for valid json, yml or compilable code. Well, that’s brilliant. No, more unnecessary failing ci/cd pipelines. Hooray! The way I understand it tho, is that before pre-commit, git hooks were project specific and resided in your .git folder, or they’re global, tedious to setup and share among contributors of your projects.</p><h3 id="enter-pre-commit">enter pre-commit</h3><p>Pre-commit aims to solve this by managing the installation and execution of hooks. You can either use one of the <a href="https://github.com/pre-commit/pre-commit-hooks">out-of-the-box hooks</a> or custom hooks ones, e.g. for <a href="https://iwpnd.pw/articles/2020-01/black-python-code-formatter">black</a>.</p><h3 id="installation">installation</h3><p>The installation is as easy as</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install pre-commit
</code></pre></div></div><p>Then you create a <code class="language-plaintext highlighter-rouge">.pre-commit-config.yaml</code>. You can do this either on your own, or use the sample config that comes with it executing</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pre-commit sample-config
</code></pre></div></div><p>What I happen to use is this:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">repos</span><span class="pi">:</span>
    <span class="pi">-</span>   <span class="na">repo</span><span class="pi">:</span> <span class="s">https://github.com/pre-commit/pre-commit-hooks</span>
        <span class="na">rev</span><span class="pi">:</span> <span class="s">v2.3.0</span>
        <span class="na">hooks</span><span class="pi">:</span>
        <span class="pi">-</span>   <span class="na">id</span><span class="pi">:</span> <span class="s">check-yaml</span>
            <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">--unsafe</span><span class="pi">]</span>
        <span class="pi">-</span>   <span class="na">id</span><span class="pi">:</span> <span class="s">end-of-file-fixer</span>
        <span class="pi">-</span>   <span class="na">id</span><span class="pi">:</span> <span class="s">trailing-whitespace</span>
        <span class="pi">-</span>   <span class="na">id</span><span class="pi">:</span> <span class="s">check-json</span>
        <span class="pi">-</span>   <span class="na">id</span><span class="pi">:</span> <span class="s">check-added-large-files</span>
        <span class="pi">-</span>   <span class="na">id</span><span class="pi">:</span> <span class="s">check-ast</span>
    <span class="pi">-</span>   <span class="na">repo</span><span class="pi">:</span> <span class="s">https://github.com/psf/black</span>
        <span class="na">rev</span><span class="pi">:</span> <span class="s">19.3b0</span>
        <span class="na">hooks</span><span class="pi">:</span>
        <span class="pi">-</span>   <span class="na">id</span><span class="pi">:</span> <span class="s">black</span>
</code></pre></div></div><p>All the config does, is specifying the repositories that contain the hooks you want to use, and optional args you can add to specific hooks. After you setup your config, you attach the hooks to your repository using:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pre-commit install
</code></pre></div></div><p>From now, when you want to <code class="language-plaintext highlighter-rouge">git add</code> and <code class="language-plaintext highlighter-rouge">git commit</code> a diff, pre-commit will perform the checks you specified in your <code class="language-plaintext highlighter-rouge">.pre-commit-config.yaml</code>.</p><p><img src="/img/2020-01-10-pre-commit.png" alt="pre-commit workflow" /></p><p>If all checks pass, your commit goes through. If checks fail, or hooks modified your files during the checks, you either have to edit, add and commit them again, or automate that part. <code class="language-plaintext highlighter-rouge">check-json</code> for example has an <code class="language-plaintext highlighter-rouge">--autofix</code> argument, that automatically attempts to fix your brokes .json files before they’re committed.</p><p>That’s it!</p><span class="meta"><time datetime="2020-01-10T11:37:00+00:00">January 10, 2020</time> &middot; <a href="/tag/pre-commit">pre-commit</a>, <a href="/tag/python">python</a>, <a href="/tag/black">black</a>, <a href="/tag/git hooks">git hooks</a></span></section></main></body></html>
