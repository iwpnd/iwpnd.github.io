<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Tile38 in-memory geodatabase" /><meta name="author" content="iwpnd" /><meta property="og:locale" content="en_US" /><meta name="description" content="geographer turned data engineer turned backend developer" /><meta property="og:description" content="geographer turned data engineer turned backend developer" /><link rel="canonical" href="https://iwpnd.pw//articles/2021-04/Tile38-in-memory-geodatabase" /><meta property="og:url" content="https://iwpnd.pw//articles/2021-04/Tile38-in-memory-geodatabase" /><meta property="og:site_name" content="iwpnd" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-24T11:37:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Tile38 in-memory geodatabase" /><meta name="twitter:site" content="@imwithpanda" /><meta name="twitter:creator" content="@imwithpanda" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"iwpnd"},"dateModified":"2021-04-24T11:37:00+00:00","datePublished":"2021-04-24T11:37:00+00:00","description":"geographer turned data engineer turned backend developer","headline":"Tile38 in-memory geodatabase","mainEntityOfPage":{"@type":"WebPage","@id":"https://iwpnd.pw//articles/2021-04/Tile38-in-memory-geodatabase"},"url":"https://iwpnd.pw//articles/2021-04/Tile38-in-memory-geodatabase"}</script><title> Tile38 in-memory geodatabase - iwpnd</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="iwpnd" href="/atom.xml"><link rel="alternate" type="application/json" title="iwpnd" href="https://iwpnd.pw//feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}.highlight{background:#282a36;color:#f8f8f2;font-size:.8rem}.highlight .hll,.highlight .s,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .dl,.highlight .sd,.highlight .s2,.highlight .se,.highlight .sh,.highlight .si,.highlight .sx,.highlight .sr,.highlight .s1,.highlight .ss{color:#f1fa8c}.highlight .go{color:#44475a}.highlight .err,.highlight .g,.highlight .l,.highlight .n,.highlight .x,.highlight .p,.highlight .ge,.highlight .gr,.highlight .gh,.highlight .gi,.highlight .gp,.highlight .gs,.highlight .gu,.highlight .gt,.highlight .ld,.highlight .no,.highlight .nd,.highlight .ni,.highlight .ne,.highlight .nn,.highlight .nx,.highlight .py,.highlight .w,.highlight .bp{color:#f8f8f2}.highlight .gh,.highlight .gi,.highlight .gu{font-weight:bold}.highlight .ge{text-decoration:underline}.highlight .bp{font-style:italic}.highlight .c,.highlight .ch,.highlight .cm,.highlight .cpf,.highlight .c1,.highlight .cs{color:#6272a4}.highlight .kd,.highlight .kt,.highlight .nb,.highlight .nl,.highlight .nv,.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#8be9fd}.highlight .kd,.highlight .nb,.highlight .nl,.highlight .nv,.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{font-style:italic}.highlight .na,.highlight .nc,.highlight .nf,.highlight .fm{color:#50fa7b}.highlight .k,.highlight .o,.highlight .cp,.highlight .kc,.highlight .kn,.highlight .kp,.highlight .kr,.highlight .nt,.highlight .ow{color:#ff79c6}.highlight .m,.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo,.highlight .il{color:#bd93f9}.highlight .gd{color:#f55}</style></head><body><main role="main"><header role="banner"> <img src="/img/iwpnd-logo.png" alt="iwpnd logo"><nav role="navigation"><ul><li><a href="/" >blog</a></li><li><a href="/til" >til</a></li><li><a href="/about" >about</a></li><li><a href="/search" >search</a></li><li><a href="/imprint" >imprint</a></li></ul></nav></header><script async src="https://www.googletagmanager.com/gtag/js?id=UA-156087226-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-156087226-1'); </script><section class="post"><h2>Tile38 in-memory geodatabase</h2><p align="center"> <img src="/img/2021-04-tile38/tile38banner.png" alt="tile38banner" /></p><p>For the longest time, it was everything about PostgreSQL and PostGIS. Building something that only remotely has to handle geo-data I had PostGIS on speed-dial. Requirement analysis of what I needed from the vastness of functionality that PostGIS packs? Nope. Never. Really. What it mostly boiled down to were point-in-polygon, radius searches and if generous a KNN nearby search for either points or polygons. Do you need to use PostGIS for that? Well, if you have a bunch of points or a bunch of polygons I would do best to consider PostGIS for geo-indexed searches. That is until a friend introduced me to Tile38.</p><h2 id="tile38">Tile38</h2><p><a href="https://tile38.com">Tile38</a> is an open-source, in-memory geo data store, spatial index, and real-time geofence framework written by Josh Baker (<a href="https://github.com/tidwall">@tidwall</a>) There are some things to unpack here.</p><h2 id="in-memory-geo-datastore">In-memory geo datastore</h2><p>Yes, Tile38 works in memory like Redis, without Redis but with broadly understood Redis Protocol. So while PostGIS stores and reads data from disk, Tile38 reads and writes to and from memory. This makes it blazingly fast, as Disk I/O is removed almost entirely. Almost? Well, Tile38 by default stores every command it receives in an append-only file that can be used to restore state in case of failure. As Tile38 uses the Redis Protocol, using Tile38 comes naturally to everyone that previously worked with Redis.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SET fleet truck1 POINT 33.5123 -112.2693
</code></pre></div></div><p>This adds <code class="language-plaintext highlighter-rouge">truck1</code> to a <code class="language-plaintext highlighter-rouge">fleet</code> collection as a <code class="language-plaintext highlighter-rouge">POINT</code> with latitude <code class="language-plaintext highlighter-rouge">33.4626</code> and longitude <code class="language-plaintext highlighter-rouge">-112.1695</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET fleet truck1
</code></pre></div></div><p>And <code class="language-plaintext highlighter-rouge">GET</code> returns <code class="language-plaintext highlighter-rouge">truck1</code> from the <code class="language-plaintext highlighter-rouge">fleet</code> collection.</p><h2 id="rtree-spatial-index">Rtree spatial index</h2><p>Spatial indexes are what make a spatial database. Without an index, any search would be a sequential scan - something everybody wants to avoid at all costs when querying a database. Put simply what a spatial index does, is it groups geometries (Points, LineStrings, Polygons) using a minimum bounding rectangle. If you now have a point database and want to know how many points are within a request polygon - instead of checking every possible point, it would compare if the minimum bounding rectangles overlap and only check those that are overlapping. Overly simplified, but that’s the gist (ha!) of it. Now let’s put this index to use.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WITHIN fleet CIRCLE 33.462 -112.268 6000

&gt; {
    "ok": True,
    "elapsed": "48.8µs",
    "objects": [
        {
            "object": {
                "type": "Point",
                "coordinates": [
                    -112.2693,
                    33.5123
                ]
            },
            "id": "truck"
        }
    ],
    "count": 1,
    "cursor": 0
}
</code></pre></div></div><p>This will check the Tile38 collection <code class="language-plaintext highlighter-rouge">fleet</code> for every item, that is within a <code class="language-plaintext highlighter-rouge">CIRCLE</code> with a center point of latitude <code class="language-plaintext highlighter-rouge">33.462</code>, longitude <code class="language-plaintext highlighter-rouge">-112.268</code>, and a radius of <code class="language-plaintext highlighter-rouge">6000</code> meters.</p><h2 id="realtime-geofence-framework">Realtime geofence framework</h2><p>Performing geo-searches is mind-boggling. When I was first able to show a manager of PostGIS capabilities and speed, it blew their mind. And even today, some fellow developers stand in awe, when they request a feature from me, and I can wrap something up with PostGIS, in an instance that speeds up their services. But now imagine that instead of requesting whether a point is in a polygon from a database, the database would instead tell you when the point enters and exits the area. That is what a geofence is, and this is what Tile38 provides. This is just next-level and opens up so many possible applications. Adding a geofenced search to Tile38 is as easy as:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SETHOOK warehouse http://10.1.3.37/endpoint NEARBY fleet FENCE POINT 33.5123, -112.2693 500
</code></pre></div></div><p>This will make Tile38 send events to the given endpoint, whenever an object is in the collection <code class="language-plaintext highlighter-rouge">fleet</code> enters the area of a <code class="language-plaintext highlighter-rouge">500</code>-meter radius around latitude <code class="language-plaintext highlighter-rouge">33.5123</code> and longitude <code class="language-plaintext highlighter-rouge">-112.2693</code>.</p><h2 id="leader-and-follower-replication">Leader and follower replication</h2><p>Leader-follower replication is something that you want for every database where reliability and availability are key. In most setups like that (e.g. AWS Aurora PostgreSQL) you will have a writer (leader) that will handle incoming CREATE and UPDATE statements. And on the other hand, you will have a variable amount of reader instances that share the load of incoming requests among each other. Tile38 offers a similar setup. Say you start two Tile38 instances and call <code class="language-plaintext highlighter-rouge">FOLLOW leader-uri:9581</code>, then one will become a leader, the other will be a follower. The follower will request the current state of the leader and once caught up, will be good to receive queries. A leader will still be able to handle incoming query commands, but a follower will reject <code class="language-plaintext highlighter-rouge">SET</code> commands going forward. If the leader dies, the followers will become stale until the leader is back up, but are still able to complete requests sent to them so your application will continue to work. Something you will have to make sure is that data sent to the leader during downtime is stored somewhere - something like Apache Kafka is a good candidate for that. This setup allows for a pretty fault-tolerant setup as it works like a charm with horizontal auto-scalers for example in Kubernetes. The auto-scaler will just add pods to your service when the load on all followers exceeds a set threshold. And trust me, this happens fast. Compare this to something like AWS Aurora with PostgreSQL, and you’re not only more reliable but also waaaay cheaper off using Tile38.</p><h2 id="why-is-postgis-still-widely-used-then">Why is PostGIS still widely used then?</h2><p>Good question, with the most obvious answer being that it is plain awesome still, well understood, highly customizable, and offers functionality that is unrivaled by any other geodatabase out there. But Tile38 brought a viable alternative to PostGIS into the mix that for most applications is not only sufficient enough but also offers completely new use-cases in today’s modern event-driven architectures. The possibility to track IoT devices in space and being notified about their whereabouts is mind-bogglingly awesome. I build and will continue building applications with Tile38 going forward. But don’t worry PostGIS, there’s not a kid on the block that rivals you completely.</p><span class="meta"><time datetime="2021-04-24T11:37:00+00:00">April 24, 2021</time> &middot; <a href="/tag/tile38">tile38</a>, <a href="/tag/database">database</a>, <a href="/tag/geodata">geodata</a></span></section></main></body></html>
